{% extends "base.html" %}
{% block title %}Edit Review{% endblock %}

{% block content %}

<!-- ===== Header ===== -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-semibold">
        ğŸ“ {{ review.get_review_type_display }} Review â€“ {{ team.name }}
    </h3>
    <a href="{% url 'coordinator_team_reviews' team.id %}"
       class="btn btn-sm btn-outline-secondary">
        â† Back
    </a>
</div>

<!-- ===== Messages ===== -->
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} py-2">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

<form method="post">
{% csrf_token %}

<!-- ===== Review Details ===== -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h5 class="mb-3">ğŸ“… Review Details</h5>

        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Review date</label>
                <input type="date"
                       name="date"
                       class="form-control"
                       value="{{ review.date|date:'Y-m-d' }}">
            </div>
        </div>

        <div class="mt-3">
            <label class="form-label">Requirements for team</label>
            <textarea name="requirements"
                      rows="3"
                      class="form-control"
                      placeholder="Mention expectations like modules completed, documentation %, demo readiness, etc.">{{ review.requirements }}</textarea>
            <div class="form-text">
                These requirements will be visible to students.
            </div>
        </div>
    </div>
</div>

<!-- ===== Panel Members ===== -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h5 class="mb-3">ğŸ‘¨â€ğŸ« Panel Members</h5>

        <label class="form-label">Select panel faculty</label>
        <select name="panel_members"
                multiple
                class="form-select">
            {% for f in panel_candidates %}
                <option value="{{ f.id }}"
                    {% if f in review.panel_members.all %}selected{% endif %}>
                    {{ f.user.get_full_name|default:f.user.username }}
                </option>
            {% endfor %}
        </select>
        <div class="form-text">
            Hold <strong>Ctrl</strong> (Windows) or <strong>Cmd</strong> (Mac) to select multiple faculty.
        </div>
    </div>
</div>

<!-- ===== Rubrics ===== -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h5 class="mb-1">ğŸ“Š Evaluation Rubrics</h5>
        <p class="text-muted mb-3">
            Define how the team will be evaluated (presentation, implementation, understanding, etc.).
        </p>

        <div id="rubrics-container">
            {% for rb in review.rubrics.all %}
            <div class="row g-2 align-items-end mb-2">
                <div class="col-md-5">
                    <label class="form-label small">Rubric name</label>
                    <input type="text"
                           name="rubric_name"
                           class="form-control"
                           value="{{ rb.name }}"
                           placeholder="e.g. Implementation quality">
                </div>
                <div class="col-md-3">
                    <label class="form-label small">Weight (%)</label>
                    <input type="number"
                           name="rubric_weight"
                           class="form-control"
                           value="{{ rb.weight }}"
                           placeholder="30">
                </div>
                <div class="col-md-3">
                    <label class="form-label small">Max score</label>
                    <input type="number"
                           name="rubric_max_score"
                           class="form-control"
                           value="{{ rb.max_score }}"
                           placeholder="10">
                </div>
            </div>
            {% empty %}
            <div class="row g-2 align-items-end mb-2">
                <div class="col-md-5">
                    <label class="form-label small">Rubric name</label>
                    <input type="text"
                           name="rubric_name"
                           class="form-control"
                           placeholder="e.g. Presentation">
                </div>
                <div class="col-md-3">
                    <label class="form-label small">Weight (%)</label>
                    <input type="number"
                           name="rubric_weight"
                           class="form-control"
                           placeholder="25">
                </div>
                <div class="col-md-3">
                    <label class="form-label small">Max score</label>
                    <input type="number"
                           name="rubric_max_score"
                           class="form-control"
                           placeholder="10">
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="form-text mt-2">
            Ensure total weight adds up logically (recommended: 100%).
        </div>
    </div>
</div>

<!-- ===== Actions ===== -->
<div class="d-flex justify-content-end">
    <button type="submit" class="btn btn-primary">
        Save review
    </button>
    <a href="{% url 'coordinator_team_reviews' team.id %}"
       class="btn btn-outline-secondary ms-2">
        Cancel
    </a>
</div>

</form>

{% endblock %}
