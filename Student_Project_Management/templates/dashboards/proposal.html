{% extends "base.html" %}
{% block title %}Project Proposal{% endblock %}

{% block content %}

<!-- ===== Page Header ===== -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-semibold">üìÑ Project Proposal</h3>
    <a href="{% url 'student_dashboard' %}" class="btn btn-outline-secondary btn-sm">
        ‚Üê Back to Dashboard
    </a>
</div>

<!-- ===== Alerts ===== -->
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} py-2">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<!-- ===== Team Info ===== -->
<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <p class="mb-0">
            <strong>Team:</strong> {{ team.name }}
        </p>
    </div>
</div>

{% if is_leader %}

<!-- ===== Proposal Form ===== -->
<form method="post" enctype="multipart/form-data">

    {% csrf_token %}

    <div class="card mb-4 shadow-sm">
        <div class="card-body">

            <h5 class="mb-3">Proposal Details</h5>

            <div class="mb-3">
                <label class="form-label">Title</label>
                <input type="text"
                       name="title"
                       class="form-control"
                       value="{{ proposal.title }}"
                       required>
            </div>

            <div class="mb-3">
                <label class="form-label">Problem Statement</label>
                <textarea name="problem_statement"
                          rows="5"
                          class="form-control"
                          required>{{ proposal.problem_statement }}</textarea>
            </div>

            <div class="mb-3">
                <label class="form-label">Objectives</label>
                <textarea name="objectives"
                          rows="3"
                          class="form-control">{{ proposal.objectives }}</textarea>
            </div>

            <div class="mb-3">
                <label class="form-label">Domain / Technology</label>
                <input type="text"
                       name="domain"
                       class="form-control"
                       value="{{ proposal.domain }}">
            </div>

            <div class="mb-3">
                <label class="form-label">Expected Outcomes</label>
                <textarea name="expected_outcomes"
                          rows="3"
                          class="form-control">{{ proposal.expected_outcomes }}</textarea>
            </div>

            <div class="mb-3">
                <label class="form-label">Estimated Duration (weeks)</label>
                <input type="number"
                       name="estimated_duration_weeks"
                       min="1"
                       class="form-control"
                       value="{{ proposal.estimated_duration_weeks }}">
            </div>

        </div>
    </div>

    <!-- ===== File Upload ===== -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="mb-3">Upload Proposal Document</h5>

            <div class="mb-3">
                <input type="file"
                       name="proposal_pdf"
                       class="form-control"
                       accept="application/pdf">
                <div class="form-text">
                    Upload only PDF files. Each upload is saved as a new version.
                </div>
            </div>

            <h6 class="mt-4">Uploaded Versions</h6>

            {% if proposal.documents.all %}
                <ul class="list-group list-group-flush">
                    {% for doc in proposal.documents.all %}
                        <li class="list-group-item px-0">
                            <a href="{{ doc.file.url }}" target="_blank">
                                üìé Version {{ forloop.counter }}
                            </a>
                            <span class="text-muted small">
                                ({{ doc.uploaded_at|date:"d M Y H:i" }})
                            </span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted mb-0">No files uploaded yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- ===== Actions ===== -->
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
            üíæ Save Proposal
        </button>
        <a href="{% url 'student_dashboard' %}" class="btn btn-secondary">
            Cancel
        </a>
    </div>

</form>

{% else %}

<!-- ===== Read-only View for Members ===== -->
<div class="card shadow-sm">
    <div class="card-body">

        <h5 class="mb-3">Proposal Details</h5>

        <p><strong>Title:</strong> {{ proposal.title|default:"Not set" }}</p>

        <p><strong>Problem Statement:</strong></p>
        <p class="text-muted" style="white-space: pre-wrap;">
            {{ proposal.problem_statement|default:"Not set" }}
        </p>

        <a href="{% url 'student_dashboard' %}" class="btn btn-secondary mt-2">
            Back
        </a>

    </div>
</div>

{% endif %}

{% endblock %}
