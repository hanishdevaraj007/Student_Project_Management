{% extends "base.html" %}
{% block title %}Mentor Dashboard{% endblock %}

{% block content %}

<!-- ===== Header ===== -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-semibold">üë®‚Äçüè´ Mentor Dashboard</h3>
</div>

<!-- ===== Welcome ===== -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <p class="mb-0">
            Welcome,
            <strong>{{ faculty.user.get_full_name|default:faculty.user.username }}</strong>.
            Below are the teams assigned to you as mentor.
        </p>
    </div>
</div>

{% if teams %}
    {% for t in teams %}
        <div class="card shadow-sm mb-4">
            <div class="card-body">

                <!-- Team Header -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">{{ t.name }}</h5>
                    <span class="badge bg-secondary">
                        Team ID: {{ t.team_id_code|default:"N/A" }}
                    </span>
                </div>

                <!-- Team Meta -->
                <p class="mb-2 text-muted">
                    <strong>Department:</strong> {{ t.department.name }} |
                    <strong>Class:</strong> {{ t.class_section.name }} |
                    <strong>Batch:</strong> {{ t.batch.name }}
                </p>

                <!-- Members -->
                <p class="mb-3">
                    <strong>Members:</strong>
                    {% for m in t.members.all %}
                        {{ m.user.get_full_name|default:m.user.username }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>

                <hr>

                <!-- Proposal Section -->
                {% if t.proposal %}
                    <h6 class="fw-semibold">üìÑ Project Proposal</h6>

                    <p class="mb-1">
                        <strong>Title:</strong> {{ t.proposal.title|default:"(No title)" }}
                    </p>

                    <p class="mb-1">
                        <strong>Status:</strong>
                        {% if t.proposal.status == "APPROVED" %}
                            <span class="badge bg-success">{{ t.proposal.get_status_display }}</span>
                        {% elif t.proposal.status == "REJECTED" %}
                            <span class="badge bg-danger">{{ t.proposal.get_status_display }}</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">{{ t.proposal.get_status_display }}</span>
                        {% endif %}
                    </p>

                    <p class="mb-3">
                        <strong>Coordinator Comment:</strong><br>
                        <span class="text-muted" style="white-space: pre-wrap;">
                            {{ t.proposal.coordinator_comment|default:"(No comment)" }}
                        </span>
                    </p>

                    <!-- Documents -->
                    <h6 class="fw-semibold">üìé Latest Documents</h6>
                    <ul class="mb-3">
                        {% for doc in t.proposal.documents.all %}
                            <li>
                                <a href="{{ doc.file.url }}" target="_blank">
                                    Version {{ doc.version }}
                                </a>
                                <span class="text-muted">
                                    ({{ doc.uploaded_at|date:"d M Y H:i" }})
                                </span>
                            </li>
                        {% empty %}
                            <li class="text-muted">No documents uploaded yet.</li>
                        {% endfor %}
                    </ul>

                {% else %}
                    <p class="text-muted mb-3">üì≠ No proposal submitted yet.</p>
                {% endif %}

                <hr>

                <!-- Reviews -->
                <h6 class="fw-semibold">üìù Review Requirements</h6>

                {% if t.reviews.all %}
                    <ul class="mb-0">
                        {% for r in t.reviews.all %}
                            <li>
                                <strong>{{ r.get_review_type_display }}:</strong>
                                {{ r.requirements|default:"No specific requirements set yet." }}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted mb-0">No reviews scheduled yet.</p>
                {% endif %}

            </div>
        </div>
    {% endfor %}
{% else %}
    <p class="text-muted">No teams assigned to you as mentor yet.</p>
{% endif %}

{% endblock %}
